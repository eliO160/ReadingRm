@import "tailwindcss";

/* 
   Dark-mode helper:
   Applies styles whenever an element is inside .dark (e.g., <html class="dark">).
*/
@custom-variant dark (&:where(.dark, .dark *));

/* ----------------------------- */
/* 1) DESIGN TOKENS (CSS variables)
/* ----------------------------- */

/* defaults for light mode */
:root {
  --bg: #ffffff; /* background color */
  --fg: #111111; /* text */

  /* links + focus ring (light) */
  --link: #111111;
  --link-hover: #5e5b6a;
  --ring: #7c3aed; /* violet-600 */

  /* paper texture controls (light) */
  --texture-url: url("/textures/olga-thelavart-vS3idIiYxX0-unsplash.jpg");
  --texture-size: 512px 512px;
  --texture-repeat: repeat;
  --texture-opacity: 1;

  /* button tokens (light) */
  --btn-bg: #a78bfa;   /* violet-300 */
  --btn-fg: #111111;
  --btn-hover-bg: #8b5cf6; /* violet-500 */
  --btn-border: transparent;
  --btn-radius: 0.75rem; /* 12px rounded-xl */

  /* --- Icon button tokens --- */
  --icon-bg: #f6f6f6;            /* subtle light surface */
  --icon-fg: #111111;
  --icon-border: #e5e7eb;        /* gray-200 */
  --icon-hover-bg: #ededed;      /* a bit darker on hover */
  --icon-size: 2.5rem;           /* 40px, matches h-10 w-10 */
  --icon-radius: 0.75rem;        /* rounded-xl */
}

/* Override tokens when <html class="dark"> is present */
.dark {
  --bg: #0b0b0b;
  --fg: #f5f5f5;

  --link: #a78bfa;       /* violet-300 */
  --link-hover: #c4b5fd; /* violet-200 */
  --ring: #c4b5fd;

  --btn-bg: #7c3aed;     /* violet-600 */
  --btn-fg: #ffffff;
  --btn-hover-bg: #6d28d9; /* violet-700 */
  --btn-border: transparent;

  /* remove texture in dark for a cleaner look */
  --texture-url: none;

  --icon-bg: #1f2937;            /* slate-800-ish elevated surface */
  --icon-fg: #f5f5f5;
  --icon-border: #374151;        /* slate-700 */
  --icon-hover-bg: #2a3443;      /* slightly brighter on hover */
}

/* ----------------------------- */
/* 2) GLOBAL ELEMENT DEFAULTS
/* ----------------------------- */

html, body { height: 100%; }

html {
  background-color: var(--bg);
  background-image: var(--texture-url);
  background-repeat: var(--texture-repeat);
  background-size: var(--texture-size);
}

html.dark {
  background-image: none !important;
  background-color: #121212; /* deep gray */
}

body {
  background: transparent;           /* let html's background show */
  color: var(--fg);
  font-family: "Libre Baskerville", serif; /* site default */
  font-size: large;
  margin: 0;
  position: relative;
}

/* ----------------------------- */
/* 3) ACCESSIBILITY + RESILIENCE
/* ----------------------------- */

@media (prefers-contrast: more), (forced-colors: active), print {
  html { background-image: none; }
}

/* ----------------------------- */
/* 4) WEB FONTS
/* ----------------------------- */

/* OpenDyslexic for optional dyslexic-friendly setting */
@font-face {
  font-family: "OpenDyslexic";
  src: url("/fonts/OpenDyslexic-Regular.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* (Optional) If you self-host Inter or Atkinson, register them here too.
   Otherwise the reader will use the system stack gracefully. */

/* ----------------------------- */
/* 5) FOCUS + LINKS + TEXT BASICS
/* ----------------------------- */

:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

a {
  color: var(--link);
  text-underline-offset: 3px;
}
a:hover { color: var(--link-hover); }

p {
  line-height: 1.75;
  color: var(--fg);
}

/* Buttons (utility class) */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.625rem 1rem;
  font-weight: 600;
  text-decoration: none;
  color: var(--btn-fg);
  background: var(--btn-bg);
  border: 1px solid var(--btn-border);
  border-radius: var(--btn-radius);
  transition: transform 120ms ease, background-color 120ms ease;
  box-shadow: 0 1px 2px rgb(0 0 0 / 0.08);
}
.btn:hover { background: var(--btn-hover-bg); }
.btn:active { transform: translateY(1px); }
.btn[aria-disabled="true"], .btn:disabled { opacity: 0.55; cursor: not-allowed; }

@media (prefers-reduced-motion: reduce) { .btn { transition: none; } }

/* ----------------------------- */
/* NAV LINK (used by header items)
/* ----------------------------- */

/* Base styles shared by both <a> and <button> items in the navbar */
:is(a.nav-link, button.nav-link) {
  /* reset so <button> looks like <a> */
  appearance: none;
  background: none;
  border: 0;
  padding: 0;                     /* start clean, then add inline pad below */
  font: inherit;
  line-height: inherit;
  color: var(--link);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding-inline: 0.125rem;       /* ~ Tailwind px-0.5 */
  cursor: pointer;
}

:is(a.nav-link, button.nav-link):hover {
  color: var(--link-hover);
}

/* Active/“current page” look */
.nav-link--active {
  font-weight: 600;
  text-decoration: underline;
  text-underline-offset: 4px;
  color: var(--link);
}

/* ----------------------------- */
/* READER STYLES (shared by Reader pages + demo)
/* ----------------------------- */

/* Container establishes reader variables + paints bg/fg */
.reader {
  /* safe defaults; page will add modifiers below */
  --reader-bg: var(--bg);
  --reader-fg: var(--fg);
  --reader-size: 18px;
  --reader-max: 70ch;
  --reader-font: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;

  --reader-bg-img: none;
  --reader-bg-size: 512px 512px;
  --reader-bg-repeat: repeat;
  --reader-bg-attach: initial;

  background-color: var(--reader-bg);
  background-image: var(--reader-bg-img);
  background-size: var(--reader-bg-size);
  background-repeat: var(--reader-bg-repeat);
  background-attachment: var(--reader-bg-attach);
  color: var(--reader-fg);
}

/* Color modes */
.reader--light {
  --reader-bg: #fafaf9;
  --reader-fg: #1b1b1b;
}

.reader--sepia { 
  --reader-bg: #f4ecd8; 
  --reader-fg: #2b2320; 
}

.reader--paper {
  --reader-bg: #fffef9; /* subtle cream base under texture */
  --reader-fg: #211f1d;
  --reader-bg-img: url("/textures/olga-thelavart-vS3idIiYxX0-unsplash.jpg");
  --reader-bg-size: 512px 512px;
  --reader-bg-repeat: repeat;
  --reader-bg-attach: fixed; /* texture stays put on scroll */
}

.reader--dark {
  --reader-bg: #1b1d20;   /* soft neutral gray */
  --reader-fg: #e6e7eb;   /* light gray text */
  --reader-link: #9ec3ff; /* calm blue links */
  --reader-link-hover: #b7d2ff;
}
/* Font sizes */
.reader--size-s { --reader-size: 16px; }
.reader--size-m { --reader-size: 18px; }
.reader--size-l { --reader-size: 20px; }

/* Column widths */
.reader--width-s { --reader-max: 55ch; }
.reader--width-m { --reader-max: 70ch; }
.reader--width-l { --reader-max: 85ch; }

/* Font families */
.reader--font-serif    { --reader-font: Georgia, "Times New Roman", serif; }
.reader--font-sans     { --reader-font: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
.reader--font-dyslexic { --reader-font: "OpenDyslexic","Atkinson Hyperlegible",system-ui,sans-serif; }

/* The flowing text area that renders Gutenberg HTML */
.reader-content {
  max-width: var(--reader-max);
  font-family: var(--reader-font);
  font-size: var(--reader-size);
  line-height: 1.65;
  text-rendering: optimizeLegibility;
}

/* Ensure imported HTML inherits the theme color */
.reader-content,
.reader-content p,
.reader-content li,
.reader-content span,
.reader-content div,
.reader-content blockquote,
.reader-content figcaption {
  color: var(--reader-fg);
}

/* Links inside the book content: readable in both modes */
.reader-content a { color: #1d4ed8; text-decoration: underline; }
.reader--dark .reader-content a {
  color: var(--reader-link);
  text-decoration: underline;
}
.reader--dark .reader-content a:hover {
  color: var(--reader-link-hover);
}
/* Neutralize common inline PG styles that break dark mode */
.reader-content [style*="color: black"],
.reader-content [style*="color:#000"],
.reader-content [style*="color:#000000"] {
  color: var(--reader-fg) !important;
}
.reader-content [style*="background: white"],
.reader-content [style*="background:#fff"],
.reader-content [style*="background-color: white"],
.reader-content [style*="background-color:#fff"] {
  background: transparent !important;
}
/* Reader links for light/sepia/paper for gentle colors */
.reader--light .reader-content a,
.reader--paper .reader-content a,
.reader--sepia .reader-content a {
  color: #1d4ed8;             /* readable blue */
}
.reader--light .reader-content a:hover,
.reader--paper .reader-content a:hover,
.reader--sepia .reader-content a:hover {
  color: #315eea;
}

/* Shared icon button */
.icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: var(--icon-size);
  height: var(--icon-size);
  color: var(--icon-fg);
  background: var(--icon-bg);
  border: 1px solid var(--icon-border);
  border-radius: var(--icon-radius);
  box-shadow: 0 1px 2px rgb(0 0 0 / 0.08);
  transition: background-color 120ms ease, box-shadow 120ms ease, transform 120ms ease;
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
}
.icon-btn:hover   { background: var(--icon-hover-bg); }
.icon-btn:active  { transform: translateY(1px); }
.icon-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--ring);
}

/* Shared popover surface */
.popover-surface {
  background: color-mix(in oklab, var(--bg) 92%, white 8%); /* light elevate */
  border: 1px solid color-mix(in oklab, var(--fg) 12%, transparent);
  color: var(--fg);
  border-radius: 1rem; /* 16px */
  box-shadow:
    0 10px 30px rgba(0,0,0,0.20),
    0  2px  8px rgba(0,0,0,0.10);
}

/* Dark-mode popover surface tweak (slightly brighter than page) */
.dark .popover-surface {
  background: color-mix(in oklab, var(--bg) 82%, white 18%);
  border-color: color-mix(in oklab, var(--fg) 18%, transparent);
}